<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>卯月コウ雑談ビンゴ</title>
  <style>
    :root{--bg:#F9E97A}
    html,body{height:100%;}
    body{
      margin:0; font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', 'Noto Sans', 'Segoe UI', Roboto, 'Yu Gothic', 'Meiryo', sans-serif;
      background:var(--bg); display:flex; align-items:flex-start; justify-content:center; padding:40px;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{width:100%;max-width:760px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    h1{margin:0;font-size:24px}
    .controls{display:flex;gap:10px}
    button{background:#fff;border:2px solid rgba(0,0,0,0.12);padding:10px 14px;border-radius:8px;font-size:14px;cursor:pointer}
    button:active{transform:scale(0.99)}
    .board-wrap{display:flex;justify-content:center}
    .board{display:grid;gap:6px;background:rgba(255,255,255,0.12);padding:12px;border-radius:12px;}
    .cell{
      background:#fff;border-radius:8px;min-width:80px;min-height:80px;display:flex;align-items:center;justify-content:center;padding:8px;text-align:center;cursor:pointer;position:relative;user-select:none;box-shadow:0 2px 0 rgba(0,0,0,0.06);
      line-height:1.2;font-weight:600
    }
    .cell.free{font-weight:700}
    .cell.marked::after{
      content:'';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:62%;height:62%;border-radius:50%;box-shadow:0 0 0 6px rgba(255,0,0,0.16) inset;background:transparent;border:4px solid #e53935;pointer-events:none}
    .hint{font-size:13px;color:#333;margin-top:12px}
    @media (max-width:520px){
      .cell{min-width:60px;min-height:60px;font-size:13px}
    }

    /* ------------------------------
       紙吹雪アニメーション
    ------------------------------ */
    #bingo-effect {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s;
      z-index: 9999;
    }
    #bingo-effect.active {
      opacity: 1;
    }
    #bingo-text {
      font-size: 80px;
      font-weight: bold;
      color: gold;
      text-shadow: 0 0 20px white, 0 0 40px gold;
      animation: pop 0.6s ease-out forwards;
    }
    @keyframes pop {
      0% { transform: scale(0.5); opacity: 0; }
      60% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); }
    }
    #confetti {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    .confetti-piece {
      position: absolute;
      width: 10px;
      height: 14px;
      background: hsl(var(--hue), 90%, 60%);
      top: -20px;
      animation: fall linear forwards;
    }
    @keyframes fall {
      to {
        transform: translateY(110vh) rotate(360deg);
        opacity: 0;
      }
    }
    .hidden { display:none; }
  audio{display:none}
  </style>
</head>
<body>

  <!-- 豪華ビンゴ演出 -->
  <div id="bingo-effect" class="hidden">
    <div id="bingo-text">BINGO!!</div>
    <div id="confetti"></div>
  </div>

  <div class="container">
    <header>
      <h1>卯月コウ雑談ビンゴ</h1>
      <div class="controls">
        <button id="make3">3x3で作成</button>
        <button id="make4">4x4で作成</button>
      </div>
    </header>

    <div class="board-wrap">
      <div id="board" class="board" aria-live="polite"></div>
    </div>
    <div class="hint">セルをクリックすると赤い◯が付く/外れる。もう一度ボタンを押すと新しく作り直します。</div>
    <div id="howto" class="howto-box">
      <h2>遊び方</h2>
      <ol>
        <li>卯月コウの配信を聞く。</li>
        <li>ビンゴシート内のワードが登場したら、該当するマスに◯をつける。</li>
        <li>ビンゴができたら喜ぶ。</li>
      </ol>
    </div>
  </div>
  
<script>
  const words = [
    "こんばんわんわん～","初めまして、ですね","ﾋﾄﾂﾋﾄﾂ","ってぇ","これでよこれ","なんだねぇ","だけがダメ！",
    "岡目八目","──えっ、二泊！？","嘘ぺこでしょ","野菜ィ！？","ﾎﾟｫｰｳ！(ゴッチ)","好きですかー！",
    "神谷浩史","MITの首席卒業生の論文を読んだっけか","ね、オカリン。","タラオ","僕わかんないよぉ",
    "庵野がいいんじゃない","うへぇ～","まったくまったく！","ヤンス","わりぃ俺死んだ（にぃ",
    "駆けるッ！8話・・・・・・・・・・・なんだよな・・・・・・","ラ帰雪牛",
    "彼女と言うか妻というか細君というか奥さん","サルノリの棒","～なんよ","ｱｯ結果発表ーー！！",
    "ん”～(松本人志)","にへへ…","ロンドン行くよ","ちょっと待って✋"
  ];

  const markSound = new Audio("mark.mp3");
  const bingoSound = new Audio("bingo.mp3");

  let hasBingo = false;
  let bingoEffectRunning = false;

  /* ------------------------------
     紙吹雪生成
  ------------------------------ */
  function launchConfetti() {
    const confetti = document.getElementById("confetti");
    confetti.innerHTML = "";

    const count = 80;
    for (let i = 0; i < count; i++) {
      const piece = document.createElement("div");
      piece.classList.add("confetti-piece");
      piece.style.left = Math.random() * 100 + "%";
      piece.style.setProperty("--hue", Math.random() * 360);
      piece.style.animationDuration = 2 + Math.random() * 3 + "s";
      piece.style.animationDelay = Math.random() * 0.5 + "s";
      confetti.appendChild(piece);
    }
  }

  /* ------------------------------
     5秒ビンゴ演出
  ------------------------------ */
  function runBingoEffect() {
    if (bingoEffectRunning) return;
    bingoEffectRunning = true;

    const effect = document.getElementById("bingo-effect");
    effect.classList.remove("hidden");
    effect.classList.add("active");

    launchConfetti();

    bingoSound.currentTime = 0;
    bingoSound.play();

    setTimeout(() => {
      effect.classList.remove("active");
      setTimeout(() => {
        effect.classList.add("hidden");
        bingoEffectRunning = false;
      }, 400);
    }, 5000);
  }

  /* ------------------------------
     ビンゴチェック
  ------------------------------ */
  function checkBingo(n){
    const cells = [...document.querySelectorAll(".cell")];
    const grid = [];

    for(let r=0;r<n;r++){
      grid[r] = [];
      for(let c=0;c<n;c++){
        grid[r][c] = cells[r*n+c].classList.contains("marked");
      }
    }

    for(let r=0;r<n;r++){
      if(grid[r].every(v => v)) return true;
    }
    for(let c=0;c<n;c++){
      let ok = true;
      for(let r=0;r<n;r++){
        if(!grid[r][c]) ok = false;
      }
      if(ok) return true;
    }
    {
      let ok = true;
      for(let i=0;i<n;i++){
        if(!grid[i][i]) ok = false;
      }
      if(ok) return true;
    }
    {
      let ok = true;
      for(let i=0;i<n;i++){
        if(!grid[i][n-1-i]) ok = false;
      }
      if(ok) return true;
    }
    return false;
  }

  /* ------------------------------
     マスクリック
  ------------------------------ */
  function attachToggle(cell){
    cell.addEventListener("click", () => {
      cell.classList.toggle("marked");

      const n = Math.sqrt(document.querySelectorAll(".cell").length);
      const bingoNow = checkBingo(n);

      if(bingoNow && !hasBingo){
        hasBingo = true;
        runBingoEffect();
      } else if(!bingoNow) {
        markSound.currentTime = 0;
        markSound.play();
      }
    });
  }

  document.getElementById('make3').addEventListener('click', () => {
    makeBoard(3);
  });
  document.getElementById('make4').addEventListener('click', () => {
    makeBoard(4);
  });

  /* ------------------------------
     ボード生成
  ------------------------------ */
  function makeBoard(n){
    hasBingo = false;
    const area = document.getElementById("board");
    area.innerHTML = "";
    area.style.gridTemplateColumns = `repeat(${n}, 1fr)`;

    const pick = [...words].sort(() => Math.random() - 0.5);
    let idx = 0;

    for(let r=0;r<n;r++){
      for(let c=0;c<n;c++){
        const cell = document.createElement("div");
        cell.className = "cell";

        if(r === Math.floor(n/2) && c === Math.floor(n/2)){
          cell.textContent = "Free";
          cell.classList.add("marked");
        } else {
          cell.textContent = pick[idx++];
        }

        area.appendChild(cell);
        attachToggle(cell);
      }
    }
  }

  makeBoard(3);
</script>
</body>
</html>


